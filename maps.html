<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minecraft Maps</title>
  <style>
    :root {
      --bg: #0e0e11;
      --card: #17171c;
      --muted: #9aa0a6;
      --text: #e8eaed;
      --accent: #5865f2;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      padding: 18px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #222;
    }

    header h1 {
      margin: 0;
      font-size: 1.6rem;
    }

    input[type="search"] {
      background: var(--card);
      border: 1px solid #222;
      border-radius: 10px;
      padding: 10px 14px;
      color: var(--text);
      width: 260px;
    }

    .grid {
      padding: 24px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    .thumb {
      aspect-ratio: 1 / 1;
      background: #000;
    }

    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .card-body {
      padding: 12px;
    }

    .card-body h3 {
      margin: 8px 0 4px;
      font-size: 1rem;
    }

    .author {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .author svg {
      width: 14px;
      height: 14px;
      fill: #777;
    }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
      z-index: 1000;
    }

    .modal.open { display: flex; }

    .modal-content {
      background: var(--card);
      border-radius: 18px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      padding: 20px;
      position: relative;
    }

    .carousel-wrapper {
      position: relative;
      margin-bottom: 20px;
      overflow: hidden;
      border-radius: 14px;
      background: #000;
    }

    .carousel {
      display: flex;
      transition: transform 0.3s ease;
    }

    .carousel img {
      min-width: 100%;
      width: 100%;
      height: 400px;
      object-fit: contain;
      flex-shrink: 0;
    }

    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.6);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease;
      z-index: 10;
    }

    .carousel-btn:hover {
      background: rgba(0,0,0,0.8);
    }

    .carousel-btn.prev {
      left: 10px;
    }

    .carousel-btn.next {
      right: 10px;
    }

    .carousel-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .carousel-indicators {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
    }

    .indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #444;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .indicator.active {
      background: var(--accent);
    }

    .modal h2 { margin-top: 16px; }

    .modal p { color: var(--muted); }

    pre {
      background: #0b0b0e;
      border-radius: 12px;
      padding: 14px;
      overflow-x: auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    button.copy {
      background: var(--accent);
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      color: white;
      cursor: pointer;
    }

    .close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: rgba(0,0,0,0.6);
      border: none;
      font-size: 1.5rem;
      color: white;
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease;
      z-index: 20;
    }

    .close:hover {
      background: rgba(0,0,0,0.8);
    }
  </style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:24px;">
    <strong style="font-size:1.3rem;">ExampleSite</strong>
  </div>
  <nav style="display:flex;gap:18px;font-size:0.95rem;">
    <a href="/" style="color:var(--muted);cursor:pointer;text-decoration:none;">Home</a>
    <span style="font-weight:600;">Maps</span>
  </nav>
</header>

<div class="grid" id="grid"></div>

<div class="modal" id="modal" onclick="closeModalOnBackdrop(event)">
  <div class="modal-content" onclick="event.stopPropagation()">
    <button class="close" onclick="closeModal()">×</button>
    
    <div class="carousel-wrapper">
      <div class="carousel" id="carousel"></div>
      <button class="carousel-btn prev" id="prevBtn" onclick="prevImage()">‹</button>
      <button class="carousel-btn next" id="nextBtn" onclick="nextImage()">›</button>
      <div class="carousel-indicators" id="indicators"></div>
    </div>

    <h2 id="modal-name"></h2>
    <p id="modal-desc"></p>
    <div class="author" id="modal-author"></div>
    <p id="modal-coords" style="margin-top:8px;"></p>

    <h3>Teleport Command</h3>
    <p>Paste this command into Minecraft on the server to go to the map.</p>
    <pre><code id="command"></code><button class="copy" onclick="copyCmd()">Copy</button></pre>
  </div>
</div>

<script>
// Fetch JSON from URL
const MAPS_URL = "https://fragmc.github.io/telepipe.json";
let mapData = {};
const grid = document.getElementById('grid');
const search = document.getElementById('search');
let currentMapId = null;
let currentImageIndex = 0;
let currentImages = [];

fetch(MAPS_URL)
  .then(res => res.json())
  .then(data => {
    mapData = data;
    render();
  })
  .catch(err => {
    console.error('Failed to load map data:', err);
  });

function render() {
  grid.innerHTML = '';
  Object.entries(mapData).forEach(([id, map]) => {
    if (!search || map.name.toLowerCase().includes(search.value.toLowerCase())) {
      const images =
        typeof map.images === 'string'
          ? map.images.split(',').map(s => s.trim()).filter(Boolean)
          : [];
      const card = document.createElement('div');
      card.className = 'card';
      card.onclick = () => openModal(id);

      const thumb = document.createElement('div');
      thumb.className = 'thumb';
      const img = document.createElement('img');
      img.src = images.length ? images[0] : 'https://placehold.co/300x300';
      img.loading = 'lazy';
      thumb.appendChild(img);

      card.innerHTML = '';
      card.appendChild(thumb);

      const body = document.createElement('div');
      body.className = 'card-body';
      body.innerHTML = `
        <h3>${map.name}</h3>
        <div class="author">
          <svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.42 0-8 2.24-8 5v1h16v-1c0-2.76-3.58-5-8-5Z"/></svg>
          ${map.author}
        </div>
      `;

      card.appendChild(body);
      grid.appendChild(card);
    }
  });
}

function openModal(id) {
  currentMapId = id;
  currentImageIndex = 0;
  const map = mapData[id];
  
  document.getElementById('modal-name').textContent = map.name;
  document.getElementById('modal-desc').textContent = map.description;
  document.getElementById('modal-author').innerHTML = `
    <svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.42 0-8 2.24-8 5v1h16v-1c0-2.76-3.58-5-8-5Z"/></svg>
    ${map.author}
  `;

  document.getElementById('modal-coords').textContent = `Coordinates: X ${map.x}, Y ${map.y}, Z ${map.z}`;

  currentImages = map.images
    .split(',')
    .map(s => s.trim())
    .filter(Boolean);

  if (currentImages.length === 0) {
    currentImages = ['https://placehold.co/800x400'];
  }

  const carousel = document.getElementById('carousel');
  carousel.innerHTML = '';
  currentImages.forEach(src => {
    const img = document.createElement('img');
    img.src = src;
    carousel.appendChild(img);
  });

  // Setup indicators
  const indicators = document.getElementById('indicators');
  indicators.innerHTML = '';
  currentImages.forEach((_, idx) => {
    const dot = document.createElement('div');
    dot.className = 'indicator';
    if (idx === 0) dot.classList.add('active');
    dot.onclick = () => goToImage(idx);
    indicators.appendChild(dot);
  });

  updateCarousel();
  document.getElementById('command').textContent = `/map ${id}`;
  document.getElementById('modal').classList.add('open');
}

function updateCarousel() {
  const carousel = document.getElementById('carousel');
  const offset = -currentImageIndex * 100;
  carousel.style.transform = `translateX(${offset}%)`;

  // Update buttons
  document.getElementById('prevBtn').disabled = currentImageIndex === 0;
  document.getElementById('nextBtn').disabled = currentImageIndex === currentImages.length - 1;

  // Update indicators
  document.querySelectorAll('.indicator').forEach((dot, idx) => {
    dot.classList.toggle('active', idx === currentImageIndex);
  });

  // Hide arrows if only one image
  if (currentImages.length <= 1) {
    document.getElementById('prevBtn').style.display = 'none';
    document.getElementById('nextBtn').style.display = 'none';
  } else {
    document.getElementById('prevBtn').style.display = 'flex';
    document.getElementById('nextBtn').style.display = 'flex';
  }
}

function prevImage() {
  if (currentImageIndex > 0) {
    currentImageIndex--;
    updateCarousel();
  }
}

function nextImage() {
  if (currentImageIndex < currentImages.length - 1) {
    currentImageIndex++;
    updateCarousel();
  }
}

function goToImage(index) {
  currentImageIndex = index;
  updateCarousel();
}

function closeModal() {
  document.getElementById('modal').classList.remove('open');
}

function closeModalOnBackdrop(event) {
  if (event.target.id === 'modal') {
    closeModal();
  }
}

function copyCmd() {
  navigator.clipboard.writeText(`/map ${currentMapId}`);
}

if (search) {
  search.addEventListener('input', render);
}
render();
</script>

</body>
</html>